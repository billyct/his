/*
 * jQuery miniColors: A small color selector
 * Copyright 2011 Cory LaViska for A Beautiful Site, LLC. (http://abeautifulsite.net/)
 * Dual licensed under the MIT or GPL Version 2 licenses
*/
if(jQuery)(function(a){a.extend(a.fn,{miniColors:function(b,c){var d=function(b,c,d){var e=s(b.val());if(!e)e="ffffff";var f=x(e);var h=a('<a class="miniColors-trigger" style="color: #'+e+'" href="#"></a>');h.insertAfter(b);b.addClass("miniColors").data("original-maxlength",b.attr("maxlength")||null).data("original-autocomplete",b.attr("autocomplete")||null).data("letterCase",c.letterCase?c.letterCase:"uppercase").data("trigger",h).data("hsb",f).data("change",c.change?c.change:null).data("close",c.close?c.close:null).data("open",c.open?c.open:null).attr("maxlength",7).attr("autocomplete","off").val("#"+o(e,c.letterCase));if(c.readonly)b.prop("readonly",true);if(c.disabled)g(b);h.on("click.miniColors",function(a){a.preventDefault();if(b.val()==="")b.val("#");i(b)});b.on("focus.miniColors",function(a){if(b.val()==="")b.val("#");i(b)});b.on("blur.miniColors",function(a){var c=s(y(b.data("hsb")));b.val(c?"#"+o(c,b.data("letterCase")):"")});b.on("keydown.miniColors",function(a){if(a.keyCode===9)j(b)});b.on("keyup.miniColors",function(a){n(b)});b.on("paste.miniColors",function(a){setTimeout(function(){n(b)},5)})};var e=function(b){j();b=a(b);b.data("trigger").remove();b.attr("autocomplete",b.data("original-autocomplete")).attr("maxlength",b.data("original-maxlength")).removeData().removeClass("miniColors").off(".miniColors");a(document).off(".miniColors")};var f=function(a){a.prop("disabled",false).data("trigger").css("opacity",1)};var g=function(a){j(a);a.prop("disabled",true).data("trigger").css("opacity",.5)};var i=function(b){if(b.prop("disabled"))return false;j();var c=a('<div class="miniColors-selector"></div>');c.append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"><div class="miniColors-colorPicker-inner"></div></div>').append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>').css("display","none").addClass(b.attr("class"));var d=b.data("hsb");c.find(".miniColors-colors").css("backgroundColor","#"+y({h:d.h,s:100,b:100}));var e=b.data("colorPosition");if(!e)e=p(d);c.find(".miniColors-colorPicker").css("top",e.y+"px").css("left",e.x+"px");var f=b.data("huePosition");if(!f)f=q(d);c.find(".miniColors-huePicker").css("top",f.y+"px");b.data("selector",c).data("huePicker",c.find(".miniColors-huePicker")).data("colorPicker",c.find(".miniColors-colorPicker")).data("mousebutton",0);a("BODY").append(c);var g=b.data("trigger"),h=!b.is(":visible"),i=h?g.offset().top+g.outerHeight():b.offset().top+b.outerHeight(),m=h?g.offset().left:b.offset().left,n=c.outerWidth(),o=c.outerHeight(),r=g.outerWidth(),s=g.outerHeight(),u=a(window).height(),v=a(window).width(),w=a(window).scrollTop(),x=a(window).scrollLeft();if(i+o>u+w)i=i-o-s;if(m+n>v+x)m=m-n+r;c.css({top:i,left:m}).fadeIn(100);c.on("selectstart",function(){return false});if(!a.browser.msie||a.browser.msie&&a.browser.version>=9){a(window).on("resize.miniColors",function(a){j(b)})}a(document).on("mousedown.miniColors touchstart.miniColors",function(c){b.data("mousebutton",1);var d=a(c.target).parents().andSelf();if(d.hasClass("miniColors-colors")){c.preventDefault();b.data("moving","colors");k(b,c)}if(d.hasClass("miniColors-hues")){c.preventDefault();b.data("moving","hues");l(b,c)}if(d.hasClass("miniColors-selector")){c.preventDefault();return}if(d.hasClass("miniColors"))return;j(b)});a(document).on("mouseup.miniColors touchend.miniColors",function(a){a.preventDefault();b.data("mousebutton",0).removeData("moving")}).on("mousemove.miniColors touchmove.miniColors",function(a){a.preventDefault();if(b.data("mousebutton")===1){if(b.data("moving")==="colors")k(b,a);if(b.data("moving")==="hues")l(b,a)}});if(b.data("open")){b.data("open").call(b.get(0),"#"+y(d),t(d))}};var j=function(b){if(!b)b=a(".miniColors");b.each(function(){var c=a(this).data("selector");a(this).removeData("selector");a(c).fadeOut(100,function(){if(b.data("close")){var c=b.data("hsb"),d=y(c);b.data("close").call(b.get(0),"#"+d,t(c))}a(this).remove()})});a(document).off(".miniColors")};var k=function(a,b){var c=a.data("colorPicker");c.hide();var d={x:b.pageX,y:b.pageY};if(b.originalEvent.changedTouches){d.x=b.originalEvent.changedTouches[0].pageX;d.y=b.originalEvent.changedTouches[0].pageY}d.x=d.x-a.data("selector").find(".miniColors-colors").offset().left-5;d.y=d.y-a.data("selector").find(".miniColors-colors").offset().top-5;if(d.x<=-5)d.x=-5;if(d.x>=144)d.x=144;if(d.y<=-5)d.y=-5;if(d.y>=144)d.y=144;a.data("colorPosition",d);c.css("left",d.x).css("top",d.y).show();var e=Math.round((d.x+5)*.67);if(e<0)e=0;if(e>100)e=100;var f=100-Math.round((d.y+5)*.67);if(f<0)f=0;if(f>100)f=100;var g=a.data("hsb");g.s=e;g.b=f;m(a,g,true)};var l=function(a,b){var c=a.data("huePicker");c.hide();var d={y:b.pageY};if(b.originalEvent.changedTouches){d.y=b.originalEvent.changedTouches[0].pageY}d.y=d.y-a.data("selector").find(".miniColors-colors").offset().top-1;if(d.y<=-1)d.y=-1;if(d.y>=149)d.y=149;a.data("huePosition",d);c.css("top",d.y).show();var e=Math.round((150-d.y-1)*2.4);if(e<0)e=0;if(e>360)e=360;var f=a.data("hsb");f.h=e;m(a,f,true)};var m=function(a,b,c){a.data("hsb",b);var d=y(b);if(c)a.val("#"+o(d,a.data("letterCase")));a.data("trigger").css("color","#"+d);if(a.data("selector"))a.data("selector").find(".miniColors-colors").css("backgroundColor","#"+y({h:b.h,s:100,b:100}));if(a.data("change")){if(d===a.data("lastChange"))return;a.data("change").call(a.get(0),"#"+d,t(b));a.data("lastChange",d)}};var n=function(b){b.val("#"+r(b.val()));var c=s(b.val());if(!c)return false;var d=x(c);var e=b.data("hsb");if(d.h===e.h&&d.s===e.s&&d.b===e.b)return true;var f=p(d);var g=a(b.data("colorPicker"));g.css("top",f.y+"px").css("left",f.x+"px");b.data("colorPosition",f);var h=q(d);var i=a(b.data("huePicker"));i.css("top",h.y+"px");b.data("huePosition",h);m(b,d);return true};var o=function(a,b){if(b==="lowercase")return a.toLowerCase();if(b==="uppercase")return a.toUpperCase();return a};var p=function(a){var b=Math.ceil(a.s/.67);if(b<0)b=0;if(b>150)b=150;var c=150-Math.ceil(a.b/.67);if(c<0)c=0;if(c>150)c=150;return{x:b-5,y:c-5}};var q=function(a){var b=150-a.h/2.4;if(b<0)h=0;if(b>150)h=150;return{y:b-1}};var r=function(a){return a.replace(/[^A-F0-9]/ig,"")};var s=function(a){a=r(a);if(!a)return null;if(a.length===3)a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2];return a.length===6?a:null};var t=function(a){var b={};var c=Math.round(a.h);var d=Math.round(a.s*255/100);var e=Math.round(a.b*255/100);if(d===0){b.r=b.g=b.b=e}else{var f=e;var g=(255-d)*e/255;var h=(f-g)*(c%60)/60;if(c===360)c=0;if(c<60){b.r=f;b.b=g;b.g=g+h}else if(c<120){b.g=f;b.b=g;b.r=f-h}else if(c<180){b.g=f;b.r=g;b.b=g+h}else if(c<240){b.b=f;b.r=g;b.g=f-h}else if(c<300){b.b=f;b.g=g;b.r=g+h}else if(c<360){b.r=f;b.g=g;b.b=f-h}else{b.r=0;b.g=0;b.b=0}}return{r:Math.round(b.r),g:Math.round(b.g),b:Math.round(b.b)}};var u=function(b){var c=[b.r.toString(16),b.g.toString(16),b.b.toString(16)];a.each(c,function(a,b){if(b.length===1)c[a]="0"+b});return c.join("")};var v=function(a){a=parseInt(a.indexOf("#")>-1?a.substring(1):a,16);return{r:a>>16,g:(a&65280)>>8,b:a&255}};var w=function(a){var b={h:0,s:0,b:0};var c=Math.min(a.r,a.g,a.b);var d=Math.max(a.r,a.g,a.b);var e=d-c;b.b=d;b.s=d!==0?255*e/d:0;if(b.s!==0){if(a.r===d){b.h=(a.g-a.b)/e}else if(a.g===d){b.h=2+(a.b-a.r)/e}else{b.h=4+(a.r-a.g)/e}}else{b.h=-1}b.h*=60;if(b.h<0){b.h+=360}b.s*=100/255;b.b*=100/255;return b};var x=function(a){var b=w(v(a));if(b.s===0)b.h=360;return b};var y=function(a){return u(t(a))};switch(b){case"readonly":a(this).each(function(){if(!a(this).hasClass("miniColors"))return;a(this).prop("readonly",c)});return a(this);case"disabled":a(this).each(function(){if(!a(this).hasClass("miniColors"))return;if(c){g(a(this))}else{f(a(this))}});return a(this);case"value":if(c===undefined){if(!a(this).hasClass("miniColors"))return;var z=a(this),A=s(z.val());return A?"#"+o(A,z.data("letterCase")):null}a(this).each(function(){if(!a(this).hasClass("miniColors"))return;a(this).val(c);n(a(this))});return a(this);case"destroy":a(this).each(function(){if(!a(this).hasClass("miniColors"))return;e(a(this))});return a(this);default:if(!b)b={};a(this).each(function(){if(a(this)[0].tagName.toLowerCase()!=="input")return;if(a(this).data("trigger"))return;d(a(this),b,c)});return a(this)}}})})(jQuery);
